---
description: 
globs: 
alwaysApply: false
---
 # Dotfiles Configuration and Idempotency Rules

## Configuration System

### Location and Purpose
- The main configuration file is located at [install_config.sh](mdc:config/install_config.sh)
- This file controls global installation behavior and settings
- Users can override settings by creating `~/.dotfiles_config.sh`

## Idempotency Requirements

### Core Principles
1. All installation scripts MUST be idempotent
2. Scripts should check current state before making changes
3. Scripts should provide clear feedback about what they're doing
4. Scripts should handle errors gracefully

### Implementation Guidelines
1. Package Installation
   - Check if package is installed before installing
   - Support different update modes (check/update/force)
   - Verify package versions when updating

2. Configuration Files
   - Backup existing configurations before modifying
   - Check for existing symlinks before creating new ones
   - Preserve user customizations when possible

3. State Management
   - Use configuration variables to track state
   - Support both global and user-specific settings
   - Allow disabling specific components

### Testing Requirements
1. Scripts should be tested with:
   - Fresh installation
   - Partial installation
   - Multiple runs
   - Different update modes
   - Error conditions

2. Each new feature should include:
   - Configuration options
   - Idempotency checks
   - Error handling
   - User feedback

## Maintenance Guidelines

### Adding New Features
1. Update `config/install_config.sh` with new options
2. Document new configuration options
3. Implement idempotency checks
4. Add command line argument support
5. Update documentation

### Modifying Existing Features
1. Maintain backward compatibility
2. Update configuration options
3. Ensure idempotency is preserved
4. Update documentation

### Testing Changes
1. Test on fresh system
2. Test on existing system
3. Test with different configurations
4. Verify idempotency
5. Check error handling